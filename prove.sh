#!/bin/bash

circuit_id=$(curl -v -XPOST \
        -H 'authorization: bearer eyJhbGciOiJSUzI1NiIsImtpZCI6IjEwOjJlOmQ5OmUxOmI4OmEyOjM0OjM3Ojk5OjNhOjI0OmZjOmFhOmQxOmM4OjU5IiwidHlwIjoiSldUIn0.eyJhdWQiOiJodHRwczovL3Byb3ZpZGUuc2VydmljZXMvYXBpL3YxIiwiZXhwIjoxNjExMzg0OTEyLCJpYXQiOjE2MTEyOTg1MTIsImlzcyI6Imh0dHBzOi8vaWRlbnQucHJvdmlkZS5zZXJ2aWNlcyIsImp0aSI6ImUxZGIzMzI1LTIwYjctNGU0ZS04MTk2LTY5N2IxNzZjNDg5ZSIsIm5hdHMiOnsicGVybWlzc2lvbnMiOnsicHVibGlzaCI6eyJhbGxvdyI6WyJiYXNlbGluZS5cdTAwM2UiXX0sInN1YnNjcmliZSI6eyJhbGxvdyI6WyJ1c2VyLjgzMTE0N2JkLWM3OTEtNDNhZC1iZjk5LWY4OGJlOGFkMDU4NSIsIm5ldHdvcmsuKi5jb25uZWN0b3IuKiIsIm5ldHdvcmsuKi5zdGF0dXMiLCJwbGF0Zm9ybS5cdTAwM2UiLCJiYXNlbGluZS5cdTAwM2UiXX19fSwicHJ2ZCI6eyJwZXJtaXNzaW9ucyI6NDE1LCJ1c2VyX2lkIjoiODMxMTQ3YmQtYzc5MS00M2FkLWJmOTktZjg4YmU4YWQwNTg1In0sInN1YiI6InVzZXI6ODMxMTQ3YmQtYzc5MS00M2FkLWJmOTktZjg4YmU4YWQwNTg1In0.hMAUFprEnATXWcxJpIEKRQAKy1GJa36q-iUC23jgMNYu-YMOEa12Aj6cZy8PtDF6oX9f5uWAlg_2EgVvZmNImmvry9l3laGjlmOwLMAV93Rzg5XFWV9tsgjhHoBhSdZ5NtJVy6GSz4i-tLdUmvRhE6BhY33iFpd8rJtTz4ZF_PoctFVNpYoElxRzHc77J2NI9GBSq29QJC75W9ovusRK05pBjUERNrBy4Lo8euCbUJfA5PwH1SPBDH3MBAu6kSTrkw9lb9mz6E-s3OEdzmbSIlsmnZ5SLEwrTlXh_f6QdxrcNG0JT5HuzauVCc2rdEcX7mIaWsuEebebKXcK8K29qOCa4goc9lW6BInNbs3ZJD_McJJs8eNN4Wq3IEj0NlBJ2ZNIThVzDZgvjYVUu85wqJ92wKWulVJ_difPQ2ppgnRMelTnlg63l9uxDKT1qvv8Nk9DDECHKmIQMwmdC75yxJffnm5LOcdyuiPvXiyZAdKQKqa0VjuLmmbbHSXH6kxmgJIyR-0ZrVAWOxNx_ovw7CeIVmBvEPqyHx4UjLjunr5rTFEupDr0cIn-82ZCEBK7fgqOp8oetwPmElF6x8zJ51XrZCkW7n8JjxuhpQQsbwr9fHQge3-m6wC9ruH3KHnPIt4BGyb7AaA4cKKFambocj6WiYkXsv0JPzGADkQ01SQ' \
        -H 'content-type: application/json' \
        http://localhost:8080/api/v1/circuits -d '
{
  "identifier": "cubic",
  "proving_scheme": "groth16",
  "curve": "BN256",
  "provider": "gnark",
  "name": "my 1337 circuit"
}' | jq '.id' | sed 's/"//g')

sleep 1

proof=$(curl -v -XPOST \
        -H 'authorization: bearer eyJhbGciOiJSUzI1NiIsImtpZCI6IjEwOjJlOmQ5OmUxOmI4OmEyOjM0OjM3Ojk5OjNhOjI0OmZjOmFhOmQxOmM4OjU5IiwidHlwIjoiSldUIn0.eyJhdWQiOiJodHRwczovL3Byb3ZpZGUuc2VydmljZXMvYXBpL3YxIiwiZXhwIjoxNjExMzg0OTEyLCJpYXQiOjE2MTEyOTg1MTIsImlzcyI6Imh0dHBzOi8vaWRlbnQucHJvdmlkZS5zZXJ2aWNlcyIsImp0aSI6ImUxZGIzMzI1LTIwYjctNGU0ZS04MTk2LTY5N2IxNzZjNDg5ZSIsIm5hdHMiOnsicGVybWlzc2lvbnMiOnsicHVibGlzaCI6eyJhbGxvdyI6WyJiYXNlbGluZS5cdTAwM2UiXX0sInN1YnNjcmliZSI6eyJhbGxvdyI6WyJ1c2VyLjgzMTE0N2JkLWM3OTEtNDNhZC1iZjk5LWY4OGJlOGFkMDU4NSIsIm5ldHdvcmsuKi5jb25uZWN0b3IuKiIsIm5ldHdvcmsuKi5zdGF0dXMiLCJwbGF0Zm9ybS5cdTAwM2UiLCJiYXNlbGluZS5cdTAwM2UiXX19fSwicHJ2ZCI6eyJwZXJtaXNzaW9ucyI6NDE1LCJ1c2VyX2lkIjoiODMxMTQ3YmQtYzc5MS00M2FkLWJmOTktZjg4YmU4YWQwNTg1In0sInN1YiI6InVzZXI6ODMxMTQ3YmQtYzc5MS00M2FkLWJmOTktZjg4YmU4YWQwNTg1In0.hMAUFprEnATXWcxJpIEKRQAKy1GJa36q-iUC23jgMNYu-YMOEa12Aj6cZy8PtDF6oX9f5uWAlg_2EgVvZmNImmvry9l3laGjlmOwLMAV93Rzg5XFWV9tsgjhHoBhSdZ5NtJVy6GSz4i-tLdUmvRhE6BhY33iFpd8rJtTz4ZF_PoctFVNpYoElxRzHc77J2NI9GBSq29QJC75W9ovusRK05pBjUERNrBy4Lo8euCbUJfA5PwH1SPBDH3MBAu6kSTrkw9lb9mz6E-s3OEdzmbSIlsmnZ5SLEwrTlXh_f6QdxrcNG0JT5HuzauVCc2rdEcX7mIaWsuEebebKXcK8K29qOCa4goc9lW6BInNbs3ZJD_McJJs8eNN4Wq3IEj0NlBJ2ZNIThVzDZgvjYVUu85wqJ92wKWulVJ_difPQ2ppgnRMelTnlg63l9uxDKT1qvv8Nk9DDECHKmIQMwmdC75yxJffnm5LOcdyuiPvXiyZAdKQKqa0VjuLmmbbHSXH6kxmgJIyR-0ZrVAWOxNx_ovw7CeIVmBvEPqyHx4UjLjunr5rTFEupDr0cIn-82ZCEBK7fgqOp8oetwPmElF6x8zJ51XrZCkW7n8JjxuhpQQsbwr9fHQge3-m6wC9ruH3KHnPIt4BGyb7AaA4cKKFambocj6WiYkXsv0JPzGADkQ01SQ' \
        -H 'content-type: application/json' \
        http://localhost:8080/api/v1/circuits/${circuit_id}/prove -d '
{
  "witness": {
    "X": "3",
    "Y": "35"
  }
}' | jq '.proof' | sed 's/"//g')

curl -v -XPOST \
        -H 'authorization: bearer eyJhbGciOiJSUzI1NiIsImtpZCI6IjEwOjJlOmQ5OmUxOmI4OmEyOjM0OjM3Ojk5OjNhOjI0OmZjOmFhOmQxOmM4OjU5IiwidHlwIjoiSldUIn0.eyJhdWQiOiJodHRwczovL3Byb3ZpZGUuc2VydmljZXMvYXBpL3YxIiwiZXhwIjoxNjExMzg0OTEyLCJpYXQiOjE2MTEyOTg1MTIsImlzcyI6Imh0dHBzOi8vaWRlbnQucHJvdmlkZS5zZXJ2aWNlcyIsImp0aSI6ImUxZGIzMzI1LTIwYjctNGU0ZS04MTk2LTY5N2IxNzZjNDg5ZSIsIm5hdHMiOnsicGVybWlzc2lvbnMiOnsicHVibGlzaCI6eyJhbGxvdyI6WyJiYXNlbGluZS5cdTAwM2UiXX0sInN1YnNjcmliZSI6eyJhbGxvdyI6WyJ1c2VyLjgzMTE0N2JkLWM3OTEtNDNhZC1iZjk5LWY4OGJlOGFkMDU4NSIsIm5ldHdvcmsuKi5jb25uZWN0b3IuKiIsIm5ldHdvcmsuKi5zdGF0dXMiLCJwbGF0Zm9ybS5cdTAwM2UiLCJiYXNlbGluZS5cdTAwM2UiXX19fSwicHJ2ZCI6eyJwZXJtaXNzaW9ucyI6NDE1LCJ1c2VyX2lkIjoiODMxMTQ3YmQtYzc5MS00M2FkLWJmOTktZjg4YmU4YWQwNTg1In0sInN1YiI6InVzZXI6ODMxMTQ3YmQtYzc5MS00M2FkLWJmOTktZjg4YmU4YWQwNTg1In0.hMAUFprEnATXWcxJpIEKRQAKy1GJa36q-iUC23jgMNYu-YMOEa12Aj6cZy8PtDF6oX9f5uWAlg_2EgVvZmNImmvry9l3laGjlmOwLMAV93Rzg5XFWV9tsgjhHoBhSdZ5NtJVy6GSz4i-tLdUmvRhE6BhY33iFpd8rJtTz4ZF_PoctFVNpYoElxRzHc77J2NI9GBSq29QJC75W9ovusRK05pBjUERNrBy4Lo8euCbUJfA5PwH1SPBDH3MBAu6kSTrkw9lb9mz6E-s3OEdzmbSIlsmnZ5SLEwrTlXh_f6QdxrcNG0JT5HuzauVCc2rdEcX7mIaWsuEebebKXcK8K29qOCa4goc9lW6BInNbs3ZJD_McJJs8eNN4Wq3IEj0NlBJ2ZNIThVzDZgvjYVUu85wqJ92wKWulVJ_difPQ2ppgnRMelTnlg63l9uxDKT1qvv8Nk9DDECHKmIQMwmdC75yxJffnm5LOcdyuiPvXiyZAdKQKqa0VjuLmmbbHSXH6kxmgJIyR-0ZrVAWOxNx_ovw7CeIVmBvEPqyHx4UjLjunr5rTFEupDr0cIn-82ZCEBK7fgqOp8oetwPmElF6x8zJ51XrZCkW7n8JjxuhpQQsbwr9fHQge3-m6wC9ruH3KHnPIt4BGyb7AaA4cKKFambocj6WiYkXsv0JPzGADkQ01SQ' \
        -H 'content-type: application/json' \
        http://localhost:8080/api/v1/circuits/${circuit_id}/verify --data-binary @- << EOF
{
  "witness": {
    "x": "3",
    "Y": "35"
  },
  "proof": "${proof}"
}
EOF
