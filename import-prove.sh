#!/bin/bash

curl -v \
	-H 'authorization: bearer eyJhbGciOiJSUzI1NiIsImtpZCI6IjEwOjJlOmQ5OmUxOmI4OmEyOjM0OjM3Ojk5OjNhOjI0OmZjOmFhOmQxOmM4OjU5IiwidHlwIjoiSldUIn0.eyJhdWQiOiJodHRwczovL3Byb3ZpZGUuc2VydmljZXMvYXBpL3YxIiwiZXhwIjoxNjEwNzc1OTIyLCJpYXQiOjE2MTA2ODk1MjIsImlzcyI6Imh0dHBzOi8vaWRlbnQucHJvdmlkZS5zZXJ2aWNlcyIsImp0aSI6ImRmZTRkZWE3LTA0ZDUtNDJhOS1hYzM4LTkwN2I4MjdmOTg5NyIsIm5hdHMiOnsicGVybWlzc2lvbnMiOnsicHVibGlzaCI6eyJhbGxvdyI6WyJiYXNlbGluZS5cdTAwM2UiXX0sInN1YnNjcmliZSI6eyJhbGxvdyI6WyJ1c2VyLjgzMTE0N2JkLWM3OTEtNDNhZC1iZjk5LWY4OGJlOGFkMDU4NSIsIm5ldHdvcmsuKi5jb25uZWN0b3IuKiIsIm5ldHdvcmsuKi5zdGF0dXMiLCJwbGF0Zm9ybS5cdTAwM2UiLCJiYXNlbGluZS5cdTAwM2UiXX19fSwicHJ2ZCI6eyJwZXJtaXNzaW9ucyI6NDE1LCJ1c2VyX2lkIjoiODMxMTQ3YmQtYzc5MS00M2FkLWJmOTktZjg4YmU4YWQwNTg1In0sInN1YiI6InVzZXI6ODMxMTQ3YmQtYzc5MS00M2FkLWJmOTktZjg4YmU4YWQwNTg1In0.DVr1iL6AafwJL-IB7njyrWTFcK1Vlt_87s86YB75Sm6xAcLMC-JI3gNqLiMN4VrZJ0LBkSIJ5ebYY4lazqqf6k6qp1dm1v5xg34d9HRAis01obK36fheWKCucPHY__MQUvuVI3xU1bX6jk0z7tRHXaXVeJgqzxd9FIKiSlKd_lLlKVaRqLyGsifrGzte9oOo5FYE03Jk7jlUzxkZbW7pMl-TpGVLBht-i7SG59G16fkKOPxvIe8EUzaHhXe4unWOCTqGqb2ezAVpqYF4t8O_WAgOaRFXeUhfkmFA5Ii9M_xmNhzm_lWMJV4pNCIEw6m5A7BqFIhJiq6LPM9Ym5_w3e0ev2yyw2XEAL7SLcssYbH3zsgS7VSlZJz6eU1rp7QFu-ct1IZO8GhYP_1-6jOAYGREL84-y9qghBFTsO7lvzhbRAYU8GBXcuj2tqFe8vRUqG40l-qMtqMqmeZQXqv62yokLWwO-mTLPyzfUE1L2sSrpf2bH-obbsMCQ-dCRTUzbmPFpft2_fOEw0weDTxz3Fkt3yCNF1Hz6QFf48ictCZPJL_oiD2fbzHR1buOmTSj5TcmWHy9hr-RnSLvCVhdzb09MGzNlnSz3i5YkiPcsiQsmLzazwKSsadr64fxbRyEpOrslLNi1HMNBlaWtIQkkQdRmI4KpDc4RrYuILde_Go' \
        http://vault:8080/api/v1/vaults/bb974ce8-be5f-40f2-be60-a5182b7e18e4/secrets/512c9274-6fa5-481f-b5a1-4d025c3a3f7a

circuit_id=$(curl -v -XPOST \
        -H 'authorization: bearer eyJhbGciOiJSUzI1NiIsImtpZCI6IjEwOjJlOmQ5OmUxOmI4OmEyOjM0OjM3Ojk5OjNhOjI0OmZjOmFhOmQxOmM4OjU5IiwidHlwIjoiSldUIn0.eyJhdWQiOiJodHRwczovL3Byb3ZpZGUuc2VydmljZXMvYXBpL3YxIiwiZXhwIjoxNjEwNzc1OTIyLCJpYXQiOjE2MTA2ODk1MjIsImlzcyI6Imh0dHBzOi8vaWRlbnQucHJvdmlkZS5zZXJ2aWNlcyIsImp0aSI6ImRmZTRkZWE3LTA0ZDUtNDJhOS1hYzM4LTkwN2I4MjdmOTg5NyIsIm5hdHMiOnsicGVybWlzc2lvbnMiOnsicHVibGlzaCI6eyJhbGxvdyI6WyJiYXNlbGluZS5cdTAwM2UiXX0sInN1YnNjcmliZSI6eyJhbGxvdyI6WyJ1c2VyLjgzMTE0N2JkLWM3OTEtNDNhZC1iZjk5LWY4OGJlOGFkMDU4NSIsIm5ldHdvcmsuKi5jb25uZWN0b3IuKiIsIm5ldHdvcmsuKi5zdGF0dXMiLCJwbGF0Zm9ybS5cdTAwM2UiLCJiYXNlbGluZS5cdTAwM2UiXX19fSwicHJ2ZCI6eyJwZXJtaXNzaW9ucyI6NDE1LCJ1c2VyX2lkIjoiODMxMTQ3YmQtYzc5MS00M2FkLWJmOTktZjg4YmU4YWQwNTg1In0sInN1YiI6InVzZXI6ODMxMTQ3YmQtYzc5MS00M2FkLWJmOTktZjg4YmU4YWQwNTg1In0.DVr1iL6AafwJL-IB7njyrWTFcK1Vlt_87s86YB75Sm6xAcLMC-JI3gNqLiMN4VrZJ0LBkSIJ5ebYY4lazqqf6k6qp1dm1v5xg34d9HRAis01obK36fheWKCucPHY__MQUvuVI3xU1bX6jk0z7tRHXaXVeJgqzxd9FIKiSlKd_lLlKVaRqLyGsifrGzte9oOo5FYE03Jk7jlUzxkZbW7pMl-TpGVLBht-i7SG59G16fkKOPxvIe8EUzaHhXe4unWOCTqGqb2ezAVpqYF4t8O_WAgOaRFXeUhfkmFA5Ii9M_xmNhzm_lWMJV4pNCIEw6m5A7BqFIhJiq6LPM9Ym5_w3e0ev2yyw2XEAL7SLcssYbH3zsgS7VSlZJz6eU1rp7QFu-ct1IZO8GhYP_1-6jOAYGREL84-y9qghBFTsO7lvzhbRAYU8GBXcuj2tqFe8vRUqG40l-qMtqMqmeZQXqv62yokLWwO-mTLPyzfUE1L2sSrpf2bH-obbsMCQ-dCRTUzbmPFpft2_fOEw0weDTxz3Fkt3yCNF1Hz6QFf48ictCZPJL_oiD2fbzHR1buOmTSj5TcmWHy9hr-RnSLvCVhdzb09MGzNlnSz3i5YkiPcsiQsmLzazwKSsadr64fxbRyEpOrslLNi1HMNBlaWtIQkkQdRmI4KpDc4RrYuILde_Go' \
        -H 'content-type: application/json' \
        http://localhost:8080/api/v1/circuits -d '
{
    "id": "8526c6fe-9be4-4329-99f7-4c3f014d741f",
    "name": "my 1337 circuit",
    "description": null,
    "identifier": "cubic",
    "provider": "gnark",
    "curve": "BN256",
    "artifacts": {
      "binary": "ab674e625769726573056d4e625075626c69635769726573026d4e625365637265745769726573016b53656372657457697265738161786b5075626c6963576972657382684f4e455f574952456159644c6f677380694465627567496e666f81a266466f726d6174782c5b282573202a20312920213d20282573202a203529202b20282573202a203129202b20282573202a2031295d69546f5265736f6c766584040302016d4e62436f6e73747261696e7473036f4e62434f436f6e73747261696e7473026b436f6e73747261696e747383a4614c811bd8000000000000026152811bd800000000000002614f811b980000000000000066536f6c76657200a4614c811b98000000000000006152811bd800000000000002614f811b980000000000000166536f6c76657200a4614c811b58000000000000046152811b5800000000000003614f831b40000000200000031bd8000000000000021b980000000000000166536f6c766572006c436f656666696369656e747382841bac96341c4ffffffb1b36fc76959f60cd291b666ea36f7879462e1b0e0a77c19a07df2f841b1b0d0ef99fffffe61beaba68a3a32a913f1b47d8eb76d8dd06891b15d0085520f5bbc3",
      "proving_key": "0000000000000004244b3ad628e5381f4a3c3448e1210245de26ee365b4b146cf2e9782ef400000130644e72e131a029048b6e193fd841045cea24f6fd736bec231204708f7036360000000000000000b3c4d79d41a91758cb49c3517c4604a520cff123608fc9cb2b337de1c8c14f22ec9b9e2f96afef3652627366f8170a0a948dad4ac1bd5e80130b17119778465cfb3acaee30f81dee20710ead41671f568b11d9ab07b95a9bd902154d7674b5763db07d33a61dbffe9d374fe80161a8258383de8b4f140997a091f2ddd292300adcc879c389b4cfda1f83e8ad550659d2a882c5449e5f176ee179e10a9ad177330c8b35d13ae3cacbb33f5f61324e6f9e9120faa31c736a940000000592b4371e94d81fd02719443c3d5b73f3bdafced1f0e374e76f663f370c9a4e554000000000000000000000000000000000000000000000000000000000000000a972c2ec5c33bb01736d302f0d7dfa6131c32983d35251707fcead6324fd339f400000000000000000000000000000000000000000000000000000000000000080057bc7e077b04292d4f7ed197a6f1c7b2218a355e01a6336dae9f974b0111e0000000540000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000c1d827c6b0f5dea93fd8714d8141ef9379f801d8568ff30d7588980f763f9a1380057bc7e077b04292d4f7ed197a6f1c7b2218a355e01a6336dae9f974b0111e400000000000000000000000000000000000000000000000000000000000000000000004f053ee62d4178756c9a44c916d76b16cc8385a434db54d3b72ad5b0242ac5b94ee8885ea95a692a073bae4a977de9ad222d7d209569e3e2fdc92c4019813a8f6c707ff6e580287dca0d9d60991cba9e723295d2aee9f599ab0940a697cf880f2dd20b1dd39cbc51f302810bb8e4bd1733489979f2365e59952dfbd5d46fe08d400000003ec2cd9f815e5784f1a515995a0d0fe18a7dc1f8f39175c64d7a391e0b5ba5e74ce44cd0fad574667b7525869c2d2a8bc904745287d2a75c4c1eba4abd3d79e7ba320315127f02c40251e244f352fcea4dabf09790c88dcae2c8d997eb12037e1e589b1ea9a4a957c8c8b11a20e173a966bb9432ccee06f2ddcdd3234a8cf4c66252ed73783bb30cca90f4207cdeab0f674a4832500349a0baecffdb02b324f53951118e4ece6e64baac68beefefd1a4eaf7ad577ccfc391ab9aa8d124a5204f027a54203dda643570e6b162a5bde3f22d548b23cc22ce149da877d39f6f7a0d7000000054000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c21b155c4069226b67f3a419a9f4a1ecb8941ade23889a29a88cb4e46a6e1adb186b1d38832aaa2792f611feacf7980f0c3b356591774897f2f453cee981b2e59c166a9372aa9ecd3b0093d21ae49fce16d28dfb60f8252744fd89b1e624a83a2cf985bc714d818e9c11c93d0fb2589bb3a2d9f9e17ad9580ccb66e90a6993e040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      "verifying_key": "000000000000000c82684f4e455f574952456159d902154d7674b5763db07d33a61dbffe9d374fe80161a8258383de8b4f1409970000000290995664c7505202c5521dc9613ec2c7eedf7dc081e44b8a93dc20ad4e7f10e497ffd69a4c9ef702a5bcb8c67544f3b2b8e9190f8add4f5e6aac8242fdfd7ad7e589b1ea9a4a957c8c8b11a20e173a966bb9432ccee06f2ddcdd3234a8cf4c66252ed73783bb30cca90f4207cdeab0f674a4832500349a0baecffdb02b324f53951118e4ece6e64baac68beefefd1a4eaf7ad577ccfc391ab9aa8d124a5204f027a54203dda643570e6b162a5bde3f22d548b23cc22ce149da877d39f6f7a0d7e913365388916e14787aa86c3ae034422e27d37095cd34a22cd8cf81bbb4b025274a8556dcef4a20c92211d9fa39bc3e8a85febf2c05072fcfc63fb00f3db143"
    }
}' | jq '.id' | sed 's/"//g')

sleep 1

proof=$(curl -v -XPOST \
        -H 'authorization: bearer eyJhbGciOiJSUzI1NiIsImtpZCI6IjEwOjJlOmQ5OmUxOmI4OmEyOjM0OjM3Ojk5OjNhOjI0OmZjOmFhOmQxOmM4OjU5IiwidHlwIjoiSldUIn0.eyJhdWQiOiJodHRwczovL3Byb3ZpZGUuc2VydmljZXMvYXBpL3YxIiwiZXhwIjoxNjEwNzc1OTIyLCJpYXQiOjE2MTA2ODk1MjIsImlzcyI6Imh0dHBzOi8vaWRlbnQucHJvdmlkZS5zZXJ2aWNlcyIsImp0aSI6ImRmZTRkZWE3LTA0ZDUtNDJhOS1hYzM4LTkwN2I4MjdmOTg5NyIsIm5hdHMiOnsicGVybWlzc2lvbnMiOnsicHVibGlzaCI6eyJhbGxvdyI6WyJiYXNlbGluZS5cdTAwM2UiXX0sInN1YnNjcmliZSI6eyJhbGxvdyI6WyJ1c2VyLjgzMTE0N2JkLWM3OTEtNDNhZC1iZjk5LWY4OGJlOGFkMDU4NSIsIm5ldHdvcmsuKi5jb25uZWN0b3IuKiIsIm5ldHdvcmsuKi5zdGF0dXMiLCJwbGF0Zm9ybS5cdTAwM2UiLCJiYXNlbGluZS5cdTAwM2UiXX19fSwicHJ2ZCI6eyJwZXJtaXNzaW9ucyI6NDE1LCJ1c2VyX2lkIjoiODMxMTQ3YmQtYzc5MS00M2FkLWJmOTktZjg4YmU4YWQwNTg1In0sInN1YiI6InVzZXI6ODMxMTQ3YmQtYzc5MS00M2FkLWJmOTktZjg4YmU4YWQwNTg1In0.DVr1iL6AafwJL-IB7njyrWTFcK1Vlt_87s86YB75Sm6xAcLMC-JI3gNqLiMN4VrZJ0LBkSIJ5ebYY4lazqqf6k6qp1dm1v5xg34d9HRAis01obK36fheWKCucPHY__MQUvuVI3xU1bX6jk0z7tRHXaXVeJgqzxd9FIKiSlKd_lLlKVaRqLyGsifrGzte9oOo5FYE03Jk7jlUzxkZbW7pMl-TpGVLBht-i7SG59G16fkKOPxvIe8EUzaHhXe4unWOCTqGqb2ezAVpqYF4t8O_WAgOaRFXeUhfkmFA5Ii9M_xmNhzm_lWMJV4pNCIEw6m5A7BqFIhJiq6LPM9Ym5_w3e0ev2yyw2XEAL7SLcssYbH3zsgS7VSlZJz6eU1rp7QFu-ct1IZO8GhYP_1-6jOAYGREL84-y9qghBFTsO7lvzhbRAYU8GBXcuj2tqFe8vRUqG40l-qMtqMqmeZQXqv62yokLWwO-mTLPyzfUE1L2sSrpf2bH-obbsMCQ-dCRTUzbmPFpft2_fOEw0weDTxz3Fkt3yCNF1Hz6QFf48ictCZPJL_oiD2fbzHR1buOmTSj5TcmWHy9hr-RnSLvCVhdzb09MGzNlnSz3i5YkiPcsiQsmLzazwKSsadr64fxbRyEpOrslLNi1HMNBlaWtIQkkQdRmI4KpDc4RrYuILde_Go' \
        -H 'content-type: application/json' \
        http://localhost:8080/api/v1/circuits/${circuit_id}/prove -d '
{
  "witness": {
    "x": "3",
    "Y": "35"
  }
}' | jq '.proof' | sed 's/"//g')

curl -v -XPOST \
        -H 'authorization: bearer eyJhbGciOiJSUzI1NiIsImtpZCI6IjEwOjJlOmQ5OmUxOmI4OmEyOjM0OjM3Ojk5OjNhOjI0OmZjOmFhOmQxOmM4OjU5IiwidHlwIjoiSldUIn0.eyJhdWQiOiJodHRwczovL3Byb3ZpZGUuc2VydmljZXMvYXBpL3YxIiwiZXhwIjoxNjEwNzc1OTIyLCJpYXQiOjE2MTA2ODk1MjIsImlzcyI6Imh0dHBzOi8vaWRlbnQucHJvdmlkZS5zZXJ2aWNlcyIsImp0aSI6ImRmZTRkZWE3LTA0ZDUtNDJhOS1hYzM4LTkwN2I4MjdmOTg5NyIsIm5hdHMiOnsicGVybWlzc2lvbnMiOnsicHVibGlzaCI6eyJhbGxvdyI6WyJiYXNlbGluZS5cdTAwM2UiXX0sInN1YnNjcmliZSI6eyJhbGxvdyI6WyJ1c2VyLjgzMTE0N2JkLWM3OTEtNDNhZC1iZjk5LWY4OGJlOGFkMDU4NSIsIm5ldHdvcmsuKi5jb25uZWN0b3IuKiIsIm5ldHdvcmsuKi5zdGF0dXMiLCJwbGF0Zm9ybS5cdTAwM2UiLCJiYXNlbGluZS5cdTAwM2UiXX19fSwicHJ2ZCI6eyJwZXJtaXNzaW9ucyI6NDE1LCJ1c2VyX2lkIjoiODMxMTQ3YmQtYzc5MS00M2FkLWJmOTktZjg4YmU4YWQwNTg1In0sInN1YiI6InVzZXI6ODMxMTQ3YmQtYzc5MS00M2FkLWJmOTktZjg4YmU4YWQwNTg1In0.DVr1iL6AafwJL-IB7njyrWTFcK1Vlt_87s86YB75Sm6xAcLMC-JI3gNqLiMN4VrZJ0LBkSIJ5ebYY4lazqqf6k6qp1dm1v5xg34d9HRAis01obK36fheWKCucPHY__MQUvuVI3xU1bX6jk0z7tRHXaXVeJgqzxd9FIKiSlKd_lLlKVaRqLyGsifrGzte9oOo5FYE03Jk7jlUzxkZbW7pMl-TpGVLBht-i7SG59G16fkKOPxvIe8EUzaHhXe4unWOCTqGqb2ezAVpqYF4t8O_WAgOaRFXeUhfkmFA5Ii9M_xmNhzm_lWMJV4pNCIEw6m5A7BqFIhJiq6LPM9Ym5_w3e0ev2yyw2XEAL7SLcssYbH3zsgS7VSlZJz6eU1rp7QFu-ct1IZO8GhYP_1-6jOAYGREL84-y9qghBFTsO7lvzhbRAYU8GBXcuj2tqFe8vRUqG40l-qMtqMqmeZQXqv62yokLWwO-mTLPyzfUE1L2sSrpf2bH-obbsMCQ-dCRTUzbmPFpft2_fOEw0weDTxz3Fkt3yCNF1Hz6QFf48ictCZPJL_oiD2fbzHR1buOmTSj5TcmWHy9hr-RnSLvCVhdzb09MGzNlnSz3i5YkiPcsiQsmLzazwKSsadr64fxbRyEpOrslLNi1HMNBlaWtIQkkQdRmI4KpDc4RrYuILde_Go' \
        -H 'content-type: application/json' \
        http://localhost:8080/api/v1/circuits/${circuit_id}/verify --data-binary @- << EOF
{
  "witness": {
    "x": "3",
    "Y": "35"
  },
  "proof": "${proof}"
}
EOF
