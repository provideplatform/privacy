#!/bin/bash

curl -v \
	-H 'authorization: bearer eyJhbGciOiJSUzI1NiIsImtpZCI6IjEwOjJlOmQ5OmUxOmI4OmEyOjM0OjM3Ojk5OjNhOjI0OmZjOmFhOmQxOmM4OjU5IiwidHlwIjoiSldUIn0.eyJhdWQiOiJodHRwczovL3Byb3ZpZGUuc2VydmljZXMvYXBpL3YxIiwiZXhwIjoxNjEwNzc1OTIyLCJpYXQiOjE2MTA2ODk1MjIsImlzcyI6Imh0dHBzOi8vaWRlbnQucHJvdmlkZS5zZXJ2aWNlcyIsImp0aSI6ImRmZTRkZWE3LTA0ZDUtNDJhOS1hYzM4LTkwN2I4MjdmOTg5NyIsIm5hdHMiOnsicGVybWlzc2lvbnMiOnsicHVibGlzaCI6eyJhbGxvdyI6WyJiYXNlbGluZS5cdTAwM2UiXX0sInN1YnNjcmliZSI6eyJhbGxvdyI6WyJ1c2VyLjgzMTE0N2JkLWM3OTEtNDNhZC1iZjk5LWY4OGJlOGFkMDU4NSIsIm5ldHdvcmsuKi5jb25uZWN0b3IuKiIsIm5ldHdvcmsuKi5zdGF0dXMiLCJwbGF0Zm9ybS5cdTAwM2UiLCJiYXNlbGluZS5cdTAwM2UiXX19fSwicHJ2ZCI6eyJwZXJtaXNzaW9ucyI6NDE1LCJ1c2VyX2lkIjoiODMxMTQ3YmQtYzc5MS00M2FkLWJmOTktZjg4YmU4YWQwNTg1In0sInN1YiI6InVzZXI6ODMxMTQ3YmQtYzc5MS00M2FkLWJmOTktZjg4YmU4YWQwNTg1In0.DVr1iL6AafwJL-IB7njyrWTFcK1Vlt_87s86YB75Sm6xAcLMC-JI3gNqLiMN4VrZJ0LBkSIJ5ebYY4lazqqf6k6qp1dm1v5xg34d9HRAis01obK36fheWKCucPHY__MQUvuVI3xU1bX6jk0z7tRHXaXVeJgqzxd9FIKiSlKd_lLlKVaRqLyGsifrGzte9oOo5FYE03Jk7jlUzxkZbW7pMl-TpGVLBht-i7SG59G16fkKOPxvIe8EUzaHhXe4unWOCTqGqb2ezAVpqYF4t8O_WAgOaRFXeUhfkmFA5Ii9M_xmNhzm_lWMJV4pNCIEw6m5A7BqFIhJiq6LPM9Ym5_w3e0ev2yyw2XEAL7SLcssYbH3zsgS7VSlZJz6eU1rp7QFu-ct1IZO8GhYP_1-6jOAYGREL84-y9qghBFTsO7lvzhbRAYU8GBXcuj2tqFe8vRUqG40l-qMtqMqmeZQXqv62yokLWwO-mTLPyzfUE1L2sSrpf2bH-obbsMCQ-dCRTUzbmPFpft2_fOEw0weDTxz3Fkt3yCNF1Hz6QFf48ictCZPJL_oiD2fbzHR1buOmTSj5TcmWHy9hr-RnSLvCVhdzb09MGzNlnSz3i5YkiPcsiQsmLzazwKSsadr64fxbRyEpOrslLNi1HMNBlaWtIQkkQdRmI4KpDc4RrYuILde_Go' \
        http://vault:8080/api/v1/vaults/bb974ce8-be5f-40f2-be60-a5182b7e18e4/secrets/512c9274-6fa5-481f-b5a1-4d025c3a3f7a

circuit_id=$(curl -v -XPOST \
        -H 'authorization: bearer eyJhbGciOiJSUzI1NiIsImtpZCI6IjEwOjJlOmQ5OmUxOmI4OmEyOjM0OjM3Ojk5OjNhOjI0OmZjOmFhOmQxOmM4OjU5IiwidHlwIjoiSldUIn0.eyJhdWQiOiJodHRwczovL3Byb3ZpZGUuc2VydmljZXMvYXBpL3YxIiwiZXhwIjoxNjEwNzc1OTIyLCJpYXQiOjE2MTA2ODk1MjIsImlzcyI6Imh0dHBzOi8vaWRlbnQucHJvdmlkZS5zZXJ2aWNlcyIsImp0aSI6ImRmZTRkZWE3LTA0ZDUtNDJhOS1hYzM4LTkwN2I4MjdmOTg5NyIsIm5hdHMiOnsicGVybWlzc2lvbnMiOnsicHVibGlzaCI6eyJhbGxvdyI6WyJiYXNlbGluZS5cdTAwM2UiXX0sInN1YnNjcmliZSI6eyJhbGxvdyI6WyJ1c2VyLjgzMTE0N2JkLWM3OTEtNDNhZC1iZjk5LWY4OGJlOGFkMDU4NSIsIm5ldHdvcmsuKi5jb25uZWN0b3IuKiIsIm5ldHdvcmsuKi5zdGF0dXMiLCJwbGF0Zm9ybS5cdTAwM2UiLCJiYXNlbGluZS5cdTAwM2UiXX19fSwicHJ2ZCI6eyJwZXJtaXNzaW9ucyI6NDE1LCJ1c2VyX2lkIjoiODMxMTQ3YmQtYzc5MS00M2FkLWJmOTktZjg4YmU4YWQwNTg1In0sInN1YiI6InVzZXI6ODMxMTQ3YmQtYzc5MS00M2FkLWJmOTktZjg4YmU4YWQwNTg1In0.DVr1iL6AafwJL-IB7njyrWTFcK1Vlt_87s86YB75Sm6xAcLMC-JI3gNqLiMN4VrZJ0LBkSIJ5ebYY4lazqqf6k6qp1dm1v5xg34d9HRAis01obK36fheWKCucPHY__MQUvuVI3xU1bX6jk0z7tRHXaXVeJgqzxd9FIKiSlKd_lLlKVaRqLyGsifrGzte9oOo5FYE03Jk7jlUzxkZbW7pMl-TpGVLBht-i7SG59G16fkKOPxvIe8EUzaHhXe4unWOCTqGqb2ezAVpqYF4t8O_WAgOaRFXeUhfkmFA5Ii9M_xmNhzm_lWMJV4pNCIEw6m5A7BqFIhJiq6LPM9Ym5_w3e0ev2yyw2XEAL7SLcssYbH3zsgS7VSlZJz6eU1rp7QFu-ct1IZO8GhYP_1-6jOAYGREL84-y9qghBFTsO7lvzhbRAYU8GBXcuj2tqFe8vRUqG40l-qMtqMqmeZQXqv62yokLWwO-mTLPyzfUE1L2sSrpf2bH-obbsMCQ-dCRTUzbmPFpft2_fOEw0weDTxz3Fkt3yCNF1Hz6QFf48ictCZPJL_oiD2fbzHR1buOmTSj5TcmWHy9hr-RnSLvCVhdzb09MGzNlnSz3i5YkiPcsiQsmLzazwKSsadr64fxbRyEpOrslLNi1HMNBlaWtIQkkQdRmI4KpDc4RrYuILde_Go' \
        -H 'content-type: application/json' \
        http://localhost:8080/api/v1/circuits -d '
{
  "identifier": "cubic",
  "proving_scheme": "groth16",
  "curve": "BN256",
  "provider": "gnark",
  "name": "my 1337 circuit"
}' | jq '.id' | sed 's/"//g')

sleep 1

proof=$(curl -v -XPOST \
        -H 'authorization: bearer eyJhbGciOiJSUzI1NiIsImtpZCI6IjEwOjJlOmQ5OmUxOmI4OmEyOjM0OjM3Ojk5OjNhOjI0OmZjOmFhOmQxOmM4OjU5IiwidHlwIjoiSldUIn0.eyJhdWQiOiJodHRwczovL3Byb3ZpZGUuc2VydmljZXMvYXBpL3YxIiwiZXhwIjoxNjEwNzc1OTIyLCJpYXQiOjE2MTA2ODk1MjIsImlzcyI6Imh0dHBzOi8vaWRlbnQucHJvdmlkZS5zZXJ2aWNlcyIsImp0aSI6ImRmZTRkZWE3LTA0ZDUtNDJhOS1hYzM4LTkwN2I4MjdmOTg5NyIsIm5hdHMiOnsicGVybWlzc2lvbnMiOnsicHVibGlzaCI6eyJhbGxvdyI6WyJiYXNlbGluZS5cdTAwM2UiXX0sInN1YnNjcmliZSI6eyJhbGxvdyI6WyJ1c2VyLjgzMTE0N2JkLWM3OTEtNDNhZC1iZjk5LWY4OGJlOGFkMDU4NSIsIm5ldHdvcmsuKi5jb25uZWN0b3IuKiIsIm5ldHdvcmsuKi5zdGF0dXMiLCJwbGF0Zm9ybS5cdTAwM2UiLCJiYXNlbGluZS5cdTAwM2UiXX19fSwicHJ2ZCI6eyJwZXJtaXNzaW9ucyI6NDE1LCJ1c2VyX2lkIjoiODMxMTQ3YmQtYzc5MS00M2FkLWJmOTktZjg4YmU4YWQwNTg1In0sInN1YiI6InVzZXI6ODMxMTQ3YmQtYzc5MS00M2FkLWJmOTktZjg4YmU4YWQwNTg1In0.DVr1iL6AafwJL-IB7njyrWTFcK1Vlt_87s86YB75Sm6xAcLMC-JI3gNqLiMN4VrZJ0LBkSIJ5ebYY4lazqqf6k6qp1dm1v5xg34d9HRAis01obK36fheWKCucPHY__MQUvuVI3xU1bX6jk0z7tRHXaXVeJgqzxd9FIKiSlKd_lLlKVaRqLyGsifrGzte9oOo5FYE03Jk7jlUzxkZbW7pMl-TpGVLBht-i7SG59G16fkKOPxvIe8EUzaHhXe4unWOCTqGqb2ezAVpqYF4t8O_WAgOaRFXeUhfkmFA5Ii9M_xmNhzm_lWMJV4pNCIEw6m5A7BqFIhJiq6LPM9Ym5_w3e0ev2yyw2XEAL7SLcssYbH3zsgS7VSlZJz6eU1rp7QFu-ct1IZO8GhYP_1-6jOAYGREL84-y9qghBFTsO7lvzhbRAYU8GBXcuj2tqFe8vRUqG40l-qMtqMqmeZQXqv62yokLWwO-mTLPyzfUE1L2sSrpf2bH-obbsMCQ-dCRTUzbmPFpft2_fOEw0weDTxz3Fkt3yCNF1Hz6QFf48ictCZPJL_oiD2fbzHR1buOmTSj5TcmWHy9hr-RnSLvCVhdzb09MGzNlnSz3i5YkiPcsiQsmLzazwKSsadr64fxbRyEpOrslLNi1HMNBlaWtIQkkQdRmI4KpDc4RrYuILde_Go' \
        -H 'content-type: application/json' \
        http://localhost:8080/api/v1/circuits/${circuit_id}/prove -d '
{
  "witness": {
    "x": "3",
    "Y": "35"
  }
}' | jq '.proof' | sed 's/"//g')

curl -v -XPOST \
        -H 'authorization: bearer eyJhbGciOiJSUzI1NiIsImtpZCI6IjEwOjJlOmQ5OmUxOmI4OmEyOjM0OjM3Ojk5OjNhOjI0OmZjOmFhOmQxOmM4OjU5IiwidHlwIjoiSldUIn0.eyJhdWQiOiJodHRwczovL3Byb3ZpZGUuc2VydmljZXMvYXBpL3YxIiwiZXhwIjoxNjEwNzc1OTIyLCJpYXQiOjE2MTA2ODk1MjIsImlzcyI6Imh0dHBzOi8vaWRlbnQucHJvdmlkZS5zZXJ2aWNlcyIsImp0aSI6ImRmZTRkZWE3LTA0ZDUtNDJhOS1hYzM4LTkwN2I4MjdmOTg5NyIsIm5hdHMiOnsicGVybWlzc2lvbnMiOnsicHVibGlzaCI6eyJhbGxvdyI6WyJiYXNlbGluZS5cdTAwM2UiXX0sInN1YnNjcmliZSI6eyJhbGxvdyI6WyJ1c2VyLjgzMTE0N2JkLWM3OTEtNDNhZC1iZjk5LWY4OGJlOGFkMDU4NSIsIm5ldHdvcmsuKi5jb25uZWN0b3IuKiIsIm5ldHdvcmsuKi5zdGF0dXMiLCJwbGF0Zm9ybS5cdTAwM2UiLCJiYXNlbGluZS5cdTAwM2UiXX19fSwicHJ2ZCI6eyJwZXJtaXNzaW9ucyI6NDE1LCJ1c2VyX2lkIjoiODMxMTQ3YmQtYzc5MS00M2FkLWJmOTktZjg4YmU4YWQwNTg1In0sInN1YiI6InVzZXI6ODMxMTQ3YmQtYzc5MS00M2FkLWJmOTktZjg4YmU4YWQwNTg1In0.DVr1iL6AafwJL-IB7njyrWTFcK1Vlt_87s86YB75Sm6xAcLMC-JI3gNqLiMN4VrZJ0LBkSIJ5ebYY4lazqqf6k6qp1dm1v5xg34d9HRAis01obK36fheWKCucPHY__MQUvuVI3xU1bX6jk0z7tRHXaXVeJgqzxd9FIKiSlKd_lLlKVaRqLyGsifrGzte9oOo5FYE03Jk7jlUzxkZbW7pMl-TpGVLBht-i7SG59G16fkKOPxvIe8EUzaHhXe4unWOCTqGqb2ezAVpqYF4t8O_WAgOaRFXeUhfkmFA5Ii9M_xmNhzm_lWMJV4pNCIEw6m5A7BqFIhJiq6LPM9Ym5_w3e0ev2yyw2XEAL7SLcssYbH3zsgS7VSlZJz6eU1rp7QFu-ct1IZO8GhYP_1-6jOAYGREL84-y9qghBFTsO7lvzhbRAYU8GBXcuj2tqFe8vRUqG40l-qMtqMqmeZQXqv62yokLWwO-mTLPyzfUE1L2sSrpf2bH-obbsMCQ-dCRTUzbmPFpft2_fOEw0weDTxz3Fkt3yCNF1Hz6QFf48ictCZPJL_oiD2fbzHR1buOmTSj5TcmWHy9hr-RnSLvCVhdzb09MGzNlnSz3i5YkiPcsiQsmLzazwKSsadr64fxbRyEpOrslLNi1HMNBlaWtIQkkQdRmI4KpDc4RrYuILde_Go' \
        -H 'content-type: application/json' \
        http://localhost:8080/api/v1/circuits/${circuit_id}/verify --data-binary @- << EOF
{
  "witness": {
    "x": "3",
    "Y": "35"
  },
  "proof": "${proof}"
}
EOF
