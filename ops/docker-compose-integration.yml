version: '3.5'

services:

  # Alice
  privacy0-postgres:
    image: postgres
    container_name: privacy0-postgres
    environment:
      - POSTGRES_DB=prvd
      - POSTGRES_USER=prvd
      - POSTGRES_PASSWORD=prvdp455
    healthcheck:
      test: ["CMD", "pg_isready", "-U", "prvd", "-d", "prvd"]
      interval: 1m
      timeout: 1s
      retries: 2
      start_period: 10s
    hostname: privacy0-postgres
    volumes:
      - privacy0-db:/var/lib/postgresql/data
    networks:
      - privacy0
    ports:
      - 5432:5432
    restart: always

  privacy0-redis:
    image: redis
    container_name: privacy0-redis
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 1m
      timeout: 1s
      retries: 2
      start_period: 10s
    hostname: privacy0-redis
    networks:
      - privacy0
    ports:
      - 6379:6379
    restart: always

  privacy0-nats:
    image: provide/nats-server
    container_name: privacy0-provide-nats
    command: ["-auth", "testtoken", "-p", "4222", "-D", "-V"]
    environment:
      JWT_SIGNER_PUBLIC_KEY: |-
        -----BEGIN PUBLIC KEY-----
        MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAullT/WoZnxecxKwQFlwE
        9lpQrekSD+txCgtb9T3JvvX/YkZTYkerf0rssQtrwkBlDQtm2cB5mHlRt4lRDKQy
        EA2qNJGM1Yu379abVObQ9ZXI2q7jTBZzL/Yl9AgUKlDIAXYFVfJ8XWVTi0l32Vsx
        tJSd97hiRXO+RqQu5UEr3jJ5tL73iNLp5BitRBwa4KbDCbicWKfSH5hK5DM75EyM
        R/SzR3oCLPFNLs+fyc7zH98S1atglbelkZsMk/mSIKJJl1fZFVCUxA+8CaPiKbpD
        QLpzydqyrk/y275aSU/tFHidoewvtWorNyFWRnefoWOsJFlfq1crgMu2YHTMBVtU
        SJ+4MS5D9fuk0queOqsVUgT7BVRSFHgDH7IpBZ8s9WRrpE6XOE+feTUyyWMjkVgn
        gLm5RSbHpB8Wt/Wssy3VMPV3T5uojPvX+ITmf1utz0y41gU+iZ/YFKeNN8WysLxX
        AP3Bbgo+zNLfpcrH1Y27WGBWPtHtzqiafhdfX6LQ3/zXXlNuruagjUohXaMltH+S
        K8zK4j7n+BYl+7y1dzOQw4CadsDi5whgNcg2QUxuTlW+TQ5VBvdUl9wpTSygD88H
        xH2b0OBcVjYsgRnQ9OZpQ+kIPaFhaWChnfEArCmhrOEgOnhfkr6YGDHFenfT3/RA
        PUl1cxrvY7BHh4obNa6Bf8ECAwEAAQ==
        -----END PUBLIC KEY-----
    healthcheck:
      test: ["CMD", "/usr/local/bin/await_tcp.sh", "localhost:4222"]
      interval: 1m
      timeout: 1s
      retries: 2
      start_period: 10s
    hostname: privacy0-nats
    networks:
      - privacy0
      - privacy1
    ports:
      - 4221:4221
      - 4222:4222
    restart: always
    volumes:
      - ./ops/await_tcp.sh:/usr/local/bin/await_tcp.sh:cached

  privacy0-nats-streaming:
    image: provide/nats-streaming
    command: ["-cid", "provide", "--auth", "testtoken", "-SDV"]
    container_name: privacy0-nats-streaming
    depends_on:
      - privacy0-nats
    healthcheck:
      test: ["CMD", "/usr/local/bin/await_tcp.sh", "localhost:4222"]
      interval: 1m
      timeout: 1s
      retries: 2
      start_period: 10s
    hostname: privacy0-nats-streaming
    networks:
      - privacy0
      - privacy1
    ports:
      - 4222
    restart: always
    volumes:
      - ./ops/await_tcp.sh:/usr/local/bin/await_tcp.sh:cached

  privacy0-ident:
    image: provide/ident
    container_name: privacy0-ident
    depends_on:
      - privacy0-nats-streaming
      - privacy0-postgres
      - privacy0-redis
      - privacy0-vault
    environment:
      - DATABASE_HOST=privacy0-postgres
      - DATABASE_NAME=ident_dev
      - DATABASE_USER=ident
      - DATABASE_PASSWORD=ident
      - DATABASE_SUPERUSER=prvd
      - DATABASE_SUPERUSER_PASSWORD=prvdp455
      - NATS_CLIENT_PREFIX=ident
      - NATS_URL=nats://privacy0-nats:4222
      - NATS_STREAMING_URL=nats://privacy0-nats-streaming:4222
      - REDIS_HOSTS=privacy0-redis:6379
      - LOG_LEVEL=DEBUG
      - PORT=8080
      - VAULT_API_HOST=privacy0-vault:8080
      - VAULT_API_SCHEME=http
      - VAULT_REFRESH_TOKEN=eyJhbGciOiJSUzI1NiIsImtpZCI6IjEwOjJlOmQ5OmUxOmI4OmEyOjM0OjM3Ojk5OjNhOjI0OmZjOmFhOmQxOmM4OjU5IiwidHlwIjoiSldUIn0.eyJhdWQiOiJodHRwczovL3Byb3ZpZGUuc2VydmljZXMvYXBpL3YxIiwiaWF0IjoxNjA1NzkxMjQ4LCJpc3MiOiJodHRwczovL2lkZW50LnByb3ZpZGUuc2VydmljZXMiLCJqdGkiOiI5YjUxNGIxNS01NTdlLTRhYWQtYTcwOC0wMTcwZTAwZWE1ZmIiLCJuYXRzIjp7InBlcm1pc3Npb25zIjp7InN1YnNjcmliZSI6eyJhbGxvdyI6WyJhcHBsaWNhdGlvbi4zNjAxNTdmOC1kNWExLTQ0NDAtOTE4Yi1mNjhiYjM5YzBkODAiLCJ1c2VyLjIzY2MwN2UwLTM4NTEtNDBkZC1iNjc1LWRmNzY4MDY3MmY3ZCIsIm5ldHdvcmsuKi5jb25uZWN0b3IuKiIsIm5ldHdvcmsuKi5zdGF0dXMiLCJwbGF0Zm9ybS5cdTAwM2UiXX19fSwicHJ2ZCI6eyJhcHBsaWNhdGlvbl9pZCI6IjM2MDE1N2Y4LWQ1YTEtNDQ0MC05MThiLWY2OGJiMzljMGQ4MCIsImV4dGVuZGVkIjp7InBlcm1pc3Npb25zIjp7IioiOjUxMH19LCJwZXJtaXNzaW9ucyI6NTEwLCJ1c2VyX2lkIjoiMjNjYzA3ZTAtMzg1MS00MGRkLWI2NzUtZGY3NjgwNjcyZjdkIn0sInN1YiI6ImFwcGxpY2F0aW9uOjM2MDE1N2Y4LWQ1YTEtNDQ0MC05MThiLWY2OGJiMzljMGQ4MCJ9.SUh84MKBNstdu3KFu1zEAQq03xbPw1D0lLXeogz1HfBJy77bIGf7HLvCuc6bjkh0xj3cEuEus1dC1Dj3BvlZoSXsvz_biTzSapkXzJjpkwOL6qkYDmqTPZvXwqmk-mUNrHTPkqdiIJL7xA46tzHW3E_hjSA9HjEk1kXjPdJQ6_ifkgWNoAaSD--kudIrhZ7vLnfy0H1JEAOsXzSAMoc5_pNG2n79m0ywvb_4l9BqdsHW8N3xSQOFjcp9gD_tqo6ffug3pkpoy-RSguM_OaMR2lj_CHhYxAt0phtjUceDD3K1h5iZ38kSl7izhOdULMmGBhVpBMoSy6_R6ZzpCL3pj8FcReX9RXR5oYpm8PDtlmWqblQzjwY00-uYLfOX0_iS4MGfEsjadZPfTmJLcOTYC7H4PL9ZRu_XtMDUrGBQQz5b_ad2ZzMXbBNeU6vbxVKDG8VFKWOHAemqHTcvuOAsOCLIqOu-eJpZHlXbx-FXPTYledd-GBDe7IjaC9ll_JK3utCOnCq0qUs6lnXIrQ_Sp1LcTKJJ7aY5f9TxeoAuL-ghDbQ3Xkw6huKyPCz2evOwVLwrB9ZRMlQXgmTnB1OeQvWii1WbmkyV1Zhbz_RPB8ckK7_mFxuPvsXK8wTFiWFmj96sRX470kV-ooSfM5CzKZhSLqgyyaUNC0VaCPq0uuE
      - VAULT_SEAL_UNSEAL_KEY=forest step weird object extend boat ball unit canoe pull render monkey drink monitor behind supply brush frown alone rural minute level host clock
    healthcheck:
      test: ["CMD", "curl", "-f", "http://privacy0-ident:8080/status"]
      interval: 1m
      timeout: 1s
      retries: 2
      start_period: 10s
    hostname: privacy0-ident
    networks:
      - privacy0
    ports:
      - 8081:8080
    restart: always

  privacy0-ident-consumer:
    image: provide/ident
    entrypoint: ./ops/run_consumer.sh
    container_name: privacy0-ident-consumer
    depends_on:
      - privacy0-ident
      - privacy0-nats-streaming
      - privacy0-postgres
      - privacy0-redis
    environment:
      - CONSUME_NATS_STREAMING_SUBSCRIPTIONS=true
      - DATABASE_HOST=privacy0-postgres
      - DATABASE_NAME=ident_dev
      - DATABASE_USER=ident
      - DATABASE_PASSWORD=ident
      - DATABASE_SUPERUSER=prvd
      - DATABASE_SUPERUSER_PASSWORD=prvdp455
      - NATS_CLIENT_PREFIX=privacy0-ident-consumer
      - NATS_URL=nats://privacy0-nats:4222
      - NATS_STREAMING_URL=nats://privacy0-nats-streaming:4222
      - REDIS_HOSTS=privacy0-redis:6379
      - LOG_LEVEL=DEBUG
      - VAULT_API_HOST=privacy0-vault:8080
      - VAULT_API_SCHEME=http
      - VAULT_REFRESH_TOKEN=eyJhbGciOiJSUzI1NiIsImtpZCI6IjEwOjJlOmQ5OmUxOmI4OmEyOjM0OjM3Ojk5OjNhOjI0OmZjOmFhOmQxOmM4OjU5IiwidHlwIjoiSldUIn0.eyJhdWQiOiJodHRwczovL3Byb3ZpZGUuc2VydmljZXMvYXBpL3YxIiwiaWF0IjoxNjA1NzkxMjQ4LCJpc3MiOiJodHRwczovL2lkZW50LnByb3ZpZGUuc2VydmljZXMiLCJqdGkiOiI5YjUxNGIxNS01NTdlLTRhYWQtYTcwOC0wMTcwZTAwZWE1ZmIiLCJuYXRzIjp7InBlcm1pc3Npb25zIjp7InN1YnNjcmliZSI6eyJhbGxvdyI6WyJhcHBsaWNhdGlvbi4zNjAxNTdmOC1kNWExLTQ0NDAtOTE4Yi1mNjhiYjM5YzBkODAiLCJ1c2VyLjIzY2MwN2UwLTM4NTEtNDBkZC1iNjc1LWRmNzY4MDY3MmY3ZCIsIm5ldHdvcmsuKi5jb25uZWN0b3IuKiIsIm5ldHdvcmsuKi5zdGF0dXMiLCJwbGF0Zm9ybS5cdTAwM2UiXX19fSwicHJ2ZCI6eyJhcHBsaWNhdGlvbl9pZCI6IjM2MDE1N2Y4LWQ1YTEtNDQ0MC05MThiLWY2OGJiMzljMGQ4MCIsImV4dGVuZGVkIjp7InBlcm1pc3Npb25zIjp7IioiOjUxMH19LCJwZXJtaXNzaW9ucyI6NTEwLCJ1c2VyX2lkIjoiMjNjYzA3ZTAtMzg1MS00MGRkLWI2NzUtZGY3NjgwNjcyZjdkIn0sInN1YiI6ImFwcGxpY2F0aW9uOjM2MDE1N2Y4LWQ1YTEtNDQ0MC05MThiLWY2OGJiMzljMGQ4MCJ9.SUh84MKBNstdu3KFu1zEAQq03xbPw1D0lLXeogz1HfBJy77bIGf7HLvCuc6bjkh0xj3cEuEus1dC1Dj3BvlZoSXsvz_biTzSapkXzJjpkwOL6qkYDmqTPZvXwqmk-mUNrHTPkqdiIJL7xA46tzHW3E_hjSA9HjEk1kXjPdJQ6_ifkgWNoAaSD--kudIrhZ7vLnfy0H1JEAOsXzSAMoc5_pNG2n79m0ywvb_4l9BqdsHW8N3xSQOFjcp9gD_tqo6ffug3pkpoy-RSguM_OaMR2lj_CHhYxAt0phtjUceDD3K1h5iZ38kSl7izhOdULMmGBhVpBMoSy6_R6ZzpCL3pj8FcReX9RXR5oYpm8PDtlmWqblQzjwY00-uYLfOX0_iS4MGfEsjadZPfTmJLcOTYC7H4PL9ZRu_XtMDUrGBQQz5b_ad2ZzMXbBNeU6vbxVKDG8VFKWOHAemqHTcvuOAsOCLIqOu-eJpZHlXbx-FXPTYledd-GBDe7IjaC9ll_JK3utCOnCq0qUs6lnXIrQ_Sp1LcTKJJ7aY5f9TxeoAuL-ghDbQ3Xkw6huKyPCz2evOwVLwrB9ZRMlQXgmTnB1OeQvWii1WbmkyV1Zhbz_RPB8ckK7_mFxuPvsXK8wTFiWFmj96sRX470kV-ooSfM5CzKZhSLqgyyaUNC0VaCPq0uuE
      - VAULT_SEAL_UNSEAL_KEY=forest step weird object extend boat ball unit canoe pull render monkey drink monitor behind supply brush frown alone rural minute level host clock
    healthcheck:
      test: ["CMD", "curl", "-f", "http://privacy0-ident:8080/status"]
      interval: 1m
      timeout: 1s
      retries: 2
      start_period: 10s
    hostname: privacy0-ident-consumer
    networks:
      - privacy0
    restart: always

  privacy0-privacy:
    build: ../
    container_name: privacy0-privacy
    depends_on:
      - privacy0-nats-streaming
      - privacy0-postgres
      - privacy0-consumer
      - privacy0-redis
      - privacy0-vault
    environment:
      - DATABASE_HOST=privacy0-postgres
      - DATABASE_NAME=privacy_dev
      - DATABASE_USER=privacy
      - DATABASE_PASSWORD=privacy
      - DATABASE_SUPERUSER=prvd
      - DATABASE_SUPERUSER_PASSWORD=prvdp455
      - IDENT_API_HOST=privacy0-ident:8080
      - IDENT_API_SCHEME=http
      - LOG_LEVEL=DEBUG
      - NATS_CLIENT_PREFIX=privacy
      - NATS_URL=nats://privacy0-nats:4222
      - NATS_STREAMING_URL=nats://privacy0-nats-streaming:4222
      - PORT=8080
      - VAULT_API_HOST=privacy0-vault:8080
      - VAULT_API_SCHEME=http
      - VAULT_REFRESH_TOKEN=eyJhbGciOiJSUzI1NiIsImtpZCI6IjEwOjJlOmQ5OmUxOmI4OmEyOjM0OjM3Ojk5OjNhOjI0OmZjOmFhOmQxOmM4OjU5IiwidHlwIjoiSldUIn0.eyJhdWQiOiJodHRwczovL3Byb3ZpZGUuc2VydmljZXMvYXBpL3YxIiwiaWF0IjoxNjA1NzkxMjQ4LCJpc3MiOiJodHRwczovL2lkZW50LnByb3ZpZGUuc2VydmljZXMiLCJqdGkiOiI5YjUxNGIxNS01NTdlLTRhYWQtYTcwOC0wMTcwZTAwZWE1ZmIiLCJuYXRzIjp7InBlcm1pc3Npb25zIjp7InN1YnNjcmliZSI6eyJhbGxvdyI6WyJhcHBsaWNhdGlvbi4zNjAxNTdmOC1kNWExLTQ0NDAtOTE4Yi1mNjhiYjM5YzBkODAiLCJ1c2VyLjIzY2MwN2UwLTM4NTEtNDBkZC1iNjc1LWRmNzY4MDY3MmY3ZCIsIm5ldHdvcmsuKi5jb25uZWN0b3IuKiIsIm5ldHdvcmsuKi5zdGF0dXMiLCJwbGF0Zm9ybS5cdTAwM2UiXX19fSwicHJ2ZCI6eyJhcHBsaWNhdGlvbl9pZCI6IjM2MDE1N2Y4LWQ1YTEtNDQ0MC05MThiLWY2OGJiMzljMGQ4MCIsImV4dGVuZGVkIjp7InBlcm1pc3Npb25zIjp7IioiOjUxMH19LCJwZXJtaXNzaW9ucyI6NTEwLCJ1c2VyX2lkIjoiMjNjYzA3ZTAtMzg1MS00MGRkLWI2NzUtZGY3NjgwNjcyZjdkIn0sInN1YiI6ImFwcGxpY2F0aW9uOjM2MDE1N2Y4LWQ1YTEtNDQ0MC05MThiLWY2OGJiMzljMGQ4MCJ9.SUh84MKBNstdu3KFu1zEAQq03xbPw1D0lLXeogz1HfBJy77bIGf7HLvCuc6bjkh0xj3cEuEus1dC1Dj3BvlZoSXsvz_biTzSapkXzJjpkwOL6qkYDmqTPZvXwqmk-mUNrHTPkqdiIJL7xA46tzHW3E_hjSA9HjEk1kXjPdJQ6_ifkgWNoAaSD--kudIrhZ7vLnfy0H1JEAOsXzSAMoc5_pNG2n79m0ywvb_4l9BqdsHW8N3xSQOFjcp9gD_tqo6ffug3pkpoy-RSguM_OaMR2lj_CHhYxAt0phtjUceDD3K1h5iZ38kSl7izhOdULMmGBhVpBMoSy6_R6ZzpCL3pj8FcReX9RXR5oYpm8PDtlmWqblQzjwY00-uYLfOX0_iS4MGfEsjadZPfTmJLcOTYC7H4PL9ZRu_XtMDUrGBQQz5b_ad2ZzMXbBNeU6vbxVKDG8VFKWOHAemqHTcvuOAsOCLIqOu-eJpZHlXbx-FXPTYledd-GBDe7IjaC9ll_JK3utCOnCq0qUs6lnXIrQ_Sp1LcTKJJ7aY5f9TxeoAuL-ghDbQ3Xkw6huKyPCz2evOwVLwrB9ZRMlQXgmTnB1OeQvWii1WbmkyV1Zhbz_RPB8ckK7_mFxuPvsXK8wTFiWFmj96sRX470kV-ooSfM5CzKZhSLqgyyaUNC0VaCPq0uuE
      - VAULT_SEAL_UNSEAL_KEY=forest step weird object extend boat ball unit canoe pull render monkey drink monitor behind supply brush frown alone rural minute level host clock
    healthcheck:
      test: ["CMD", "curl", "-f", "http://privacy0-privacy:8080/status"]
      interval: 1m
      timeout: 1s
      retries: 2
      start_period: 10s
    hostname: privacy0-privacy
    networks:
      - privacy0
    ports:
      - 8080:8080
    restart: always

  privacy0-consumer:
    build: ../
    entrypoint: ./ops/run_consumer.sh
    container_name: privacy0-privacy-consumer
    depends_on:
      - privacy0-nats-streaming
      - privacy0-postgres
      - privacy0-redis
      - privacy0-vault
    environment:
      - CONSUME_NATS_STREAMING_SUBSCRIPTIONS=true
      - DATABASE_HOST=privacy0-postgres
      - DATABASE_NAME=privacy_dev
      - DATABASE_USER=privacy
      - DATABASE_PASSWORD=privacy
      - DATABASE_SUPERUSER=prvd
      - DATABASE_SUPERUSER_PASSWORD=prvdp455
      - IDENT_API_HOST=privacy0-ident:8080
      - IDENT_API_SCHEME=http
      - LOG_LEVEL=DEBUG
      - NATS_CLIENT_PREFIX=privacy-consumer
      - NATS_URL=nats://privacy0-nats:4222
      - NATS_STREAMING_URL=nats://privacy0-nats-streaming:4222
      - VAULT_API_HOST=privacy0-vault:8080
      - VAULT_API_SCHEME=http
      - VAULT_REFRESH_TOKEN=eyJhbGciOiJSUzI1NiIsImtpZCI6IjEwOjJlOmQ5OmUxOmI4OmEyOjM0OjM3Ojk5OjNhOjI0OmZjOmFhOmQxOmM4OjU5IiwidHlwIjoiSldUIn0.eyJhdWQiOiJodHRwczovL3Byb3ZpZGUuc2VydmljZXMvYXBpL3YxIiwiaWF0IjoxNjA1NzkxMjQ4LCJpc3MiOiJodHRwczovL2lkZW50LnByb3ZpZGUuc2VydmljZXMiLCJqdGkiOiI5YjUxNGIxNS01NTdlLTRhYWQtYTcwOC0wMTcwZTAwZWE1ZmIiLCJuYXRzIjp7InBlcm1pc3Npb25zIjp7InN1YnNjcmliZSI6eyJhbGxvdyI6WyJhcHBsaWNhdGlvbi4zNjAxNTdmOC1kNWExLTQ0NDAtOTE4Yi1mNjhiYjM5YzBkODAiLCJ1c2VyLjIzY2MwN2UwLTM4NTEtNDBkZC1iNjc1LWRmNzY4MDY3MmY3ZCIsIm5ldHdvcmsuKi5jb25uZWN0b3IuKiIsIm5ldHdvcmsuKi5zdGF0dXMiLCJwbGF0Zm9ybS5cdTAwM2UiXX19fSwicHJ2ZCI6eyJhcHBsaWNhdGlvbl9pZCI6IjM2MDE1N2Y4LWQ1YTEtNDQ0MC05MThiLWY2OGJiMzljMGQ4MCIsImV4dGVuZGVkIjp7InBlcm1pc3Npb25zIjp7IioiOjUxMH19LCJwZXJtaXNzaW9ucyI6NTEwLCJ1c2VyX2lkIjoiMjNjYzA3ZTAtMzg1MS00MGRkLWI2NzUtZGY3NjgwNjcyZjdkIn0sInN1YiI6ImFwcGxpY2F0aW9uOjM2MDE1N2Y4LWQ1YTEtNDQ0MC05MThiLWY2OGJiMzljMGQ4MCJ9.SUh84MKBNstdu3KFu1zEAQq03xbPw1D0lLXeogz1HfBJy77bIGf7HLvCuc6bjkh0xj3cEuEus1dC1Dj3BvlZoSXsvz_biTzSapkXzJjpkwOL6qkYDmqTPZvXwqmk-mUNrHTPkqdiIJL7xA46tzHW3E_hjSA9HjEk1kXjPdJQ6_ifkgWNoAaSD--kudIrhZ7vLnfy0H1JEAOsXzSAMoc5_pNG2n79m0ywvb_4l9BqdsHW8N3xSQOFjcp9gD_tqo6ffug3pkpoy-RSguM_OaMR2lj_CHhYxAt0phtjUceDD3K1h5iZ38kSl7izhOdULMmGBhVpBMoSy6_R6ZzpCL3pj8FcReX9RXR5oYpm8PDtlmWqblQzjwY00-uYLfOX0_iS4MGfEsjadZPfTmJLcOTYC7H4PL9ZRu_XtMDUrGBQQz5b_ad2ZzMXbBNeU6vbxVKDG8VFKWOHAemqHTcvuOAsOCLIqOu-eJpZHlXbx-FXPTYledd-GBDe7IjaC9ll_JK3utCOnCq0qUs6lnXIrQ_Sp1LcTKJJ7aY5f9TxeoAuL-ghDbQ3Xkw6huKyPCz2evOwVLwrB9ZRMlQXgmTnB1OeQvWii1WbmkyV1Zhbz_RPB8ckK7_mFxuPvsXK8wTFiWFmj96sRX470kV-ooSfM5CzKZhSLqgyyaUNC0VaCPq0uuE
      - VAULT_SEAL_UNSEAL_KEY=forest step weird object extend boat ball unit canoe pull render monkey drink monitor behind supply brush frown alone rural minute level host clock
    healthcheck:
      test: ["CMD", "curl", "-f", "http://privacy0-privacy:8080/status"]
      interval: 1m
      timeout: 1s
      retries: 2
      start_period: 10s
    hostname: privacy0-privacy-consumer
    networks:
      - privacy0
    restart: always

  privacy0-vault:
    image: provide/vault:privacy-dev
    container_name: privacy0-vault
    depends_on:
      - privacy0-ident
      - privacy0-postgres
    environment:
      - DATABASE_HOST=privacy0-postgres
      - DATABASE_NAME=vault_dev
      - DATABASE_USER=vault
      - DATABASE_PASSWORD=vault
      - DATABASE_SUPERUSER=prvd
      - DATABASE_SUPERUSER_PASSWORD=prvdp455
      - IDENT_API_HOST=privacy0-ident:8080
      - IDENT_API_SCHEME=http
      - LOG_LEVEL=DEBUG
      - PORT=8080
      - SEAL_UNSEAL_VALIDATION_HASH=0x1c1381fd075f1ee3d42799bb8da0602a2afb9ef4b492bf1eae72399ecc81b0f0
    healthcheck:
      test: ["CMD", "curl", "-f", "http://privacy0-vault:8080/status"]
      interval: 1m
      timeout: 1s
      retries: 2
      start_period: 10s
    hostname: privacy0-vault
    networks:
      - privacy0
    ports:
      - 8082:8080
    restart: always

  # Bob
  privacy1-postgres:
    image: postgres
    container_name: privacy1-postgres
    environment:
      - POSTGRES_DB=prvd
      - POSTGRES_USER=prvd
      - POSTGRES_PASSWORD=prvdp455
    healthcheck:
      test: ["CMD", "pg_isready", "-U", "prvd", "-d", "prvd"]
      interval: 1m
      timeout: 1s
      retries: 2
      start_period: 10s
    hostname: privacy1-postgres
    volumes:
      - privacy1-db:/var/lib/postgresql/data
    networks:
      - privacy1
    ports:
      - 5433:5432
    restart: always

  privacy1-redis:
    image: redis
    container_name: privacy1-redis
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 1m
      timeout: 1s
      retries: 2
      start_period: 10s
    hostname: privacy1-redis
    networks:
      - privacy1
    ports:
      - 6380:6379
    restart: always

  privacy1-nats:
    image: provide/nats-server
    container_name: privacy1-provide-nats
    command: ["-auth", "testtoken", "-p", "4222", "-D", "-V"]
    environment:
      JWT_SIGNER_PUBLIC_KEY: |-
        -----BEGIN PUBLIC KEY-----
        MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAullT/WoZnxecxKwQFlwE
        9lpQrekSD+txCgtb9T3JvvX/YkZTYkerf0rssQtrwkBlDQtm2cB5mHlRt4lRDKQy
        EA2qNJGM1Yu379abVObQ9ZXI2q7jTBZzL/Yl9AgUKlDIAXYFVfJ8XWVTi0l32Vsx
        tJSd97hiRXO+RqQu5UEr3jJ5tL73iNLp5BitRBwa4KbDCbicWKfSH5hK5DM75EyM
        R/SzR3oCLPFNLs+fyc7zH98S1atglbelkZsMk/mSIKJJl1fZFVCUxA+8CaPiKbpD
        QLpzydqyrk/y275aSU/tFHidoewvtWorNyFWRnefoWOsJFlfq1crgMu2YHTMBVtU
        SJ+4MS5D9fuk0queOqsVUgT7BVRSFHgDH7IpBZ8s9WRrpE6XOE+feTUyyWMjkVgn
        gLm5RSbHpB8Wt/Wssy3VMPV3T5uojPvX+ITmf1utz0y41gU+iZ/YFKeNN8WysLxX
        AP3Bbgo+zNLfpcrH1Y27WGBWPtHtzqiafhdfX6LQ3/zXXlNuruagjUohXaMltH+S
        K8zK4j7n+BYl+7y1dzOQw4CadsDi5whgNcg2QUxuTlW+TQ5VBvdUl9wpTSygD88H
        xH2b0OBcVjYsgRnQ9OZpQ+kIPaFhaWChnfEArCmhrOEgOnhfkr6YGDHFenfT3/RA
        PUl1cxrvY7BHh4obNa6Bf8ECAwEAAQ==
        -----END PUBLIC KEY-----
    healthcheck:
      test: ["CMD", "/usr/local/bin/await_tcp.sh", "localhost:4222"]
      interval: 1m
      timeout: 1s
      retries: 2
      start_period: 10s
    hostname: privacy1-nats
    networks:
      - privacy0
      - privacy1
    ports:
      - 4223:4221
      - 4224:4222
    restart: always
    volumes:
      - ./ops/await_tcp.sh:/usr/local/bin/await_tcp.sh:cached

  privacy1-nats-streaming:
    image: provide/nats-streaming
    command: ["-cid", "provide", "--auth", "testtoken", "-SDV"]
    container_name: privacy1-nats-streaming
    depends_on:
      - privacy1-nats
    healthcheck:
      test: ["CMD", "/usr/local/bin/await_tcp.sh", "localhost:4222"]
      interval: 1m
      timeout: 1s
      retries: 2
      start_period: 10s
    hostname: privacy1-nats-streaming
    networks:
      - privacy0
      - privacy1
    ports:
      - 4222
    restart: always
    volumes:
      - ./ops/await_tcp.sh:/usr/local/bin/await_tcp.sh:cached

  privacy1-ident:
    image: provide/ident
    container_name: privacy1-ident
    depends_on:
      - privacy1-nats-streaming
      - privacy1-postgres
      - privacy1-redis
    environment:
      - DATABASE_HOST=privacy1-postgres
      - DATABASE_NAME=ident_dev
      - DATABASE_USER=ident
      - DATABASE_PASSWORD=ident
      - DATABASE_SUPERUSER=prvd
      - DATABASE_SUPERUSER_PASSWORD=prvdp455
      - NATS_CLIENT_PREFIX=ident
      - NATS_URL=nats://privacy1-nats:4222
      - NATS_STREAMING_URL=nats://privacy1-nats-streaming:4222
      - REDIS_HOSTS=privacy1-redis:6379
      - LOG_LEVEL=DEBUG
      - PORT=8080
      - VAULT_API_HOST=privacy1-vault:8080
      - VAULT_API_SCHEME=http
      - VAULT_REFRESH_TOKEN=eyJhbGciOiJSUzI1NiIsImtpZCI6IjEwOjJlOmQ5OmUxOmI4OmEyOjM0OjM3Ojk5OjNhOjI0OmZjOmFhOmQxOmM4OjU5IiwidHlwIjoiSldUIn0.eyJhdWQiOiJodHRwczovL3Byb3ZpZGUuc2VydmljZXMvYXBpL3YxIiwiaWF0IjoxNjA1NzkxMjQ4LCJpc3MiOiJodHRwczovL2lkZW50LnByb3ZpZGUuc2VydmljZXMiLCJqdGkiOiI5YjUxNGIxNS01NTdlLTRhYWQtYTcwOC0wMTcwZTAwZWE1ZmIiLCJuYXRzIjp7InBlcm1pc3Npb25zIjp7InN1YnNjcmliZSI6eyJhbGxvdyI6WyJhcHBsaWNhdGlvbi4zNjAxNTdmOC1kNWExLTQ0NDAtOTE4Yi1mNjhiYjM5YzBkODAiLCJ1c2VyLjIzY2MwN2UwLTM4NTEtNDBkZC1iNjc1LWRmNzY4MDY3MmY3ZCIsIm5ldHdvcmsuKi5jb25uZWN0b3IuKiIsIm5ldHdvcmsuKi5zdGF0dXMiLCJwbGF0Zm9ybS5cdTAwM2UiXX19fSwicHJ2ZCI6eyJhcHBsaWNhdGlvbl9pZCI6IjM2MDE1N2Y4LWQ1YTEtNDQ0MC05MThiLWY2OGJiMzljMGQ4MCIsImV4dGVuZGVkIjp7InBlcm1pc3Npb25zIjp7IioiOjUxMH19LCJwZXJtaXNzaW9ucyI6NTEwLCJ1c2VyX2lkIjoiMjNjYzA3ZTAtMzg1MS00MGRkLWI2NzUtZGY3NjgwNjcyZjdkIn0sInN1YiI6ImFwcGxpY2F0aW9uOjM2MDE1N2Y4LWQ1YTEtNDQ0MC05MThiLWY2OGJiMzljMGQ4MCJ9.SUh84MKBNstdu3KFu1zEAQq03xbPw1D0lLXeogz1HfBJy77bIGf7HLvCuc6bjkh0xj3cEuEus1dC1Dj3BvlZoSXsvz_biTzSapkXzJjpkwOL6qkYDmqTPZvXwqmk-mUNrHTPkqdiIJL7xA46tzHW3E_hjSA9HjEk1kXjPdJQ6_ifkgWNoAaSD--kudIrhZ7vLnfy0H1JEAOsXzSAMoc5_pNG2n79m0ywvb_4l9BqdsHW8N3xSQOFjcp9gD_tqo6ffug3pkpoy-RSguM_OaMR2lj_CHhYxAt0phtjUceDD3K1h5iZ38kSl7izhOdULMmGBhVpBMoSy6_R6ZzpCL3pj8FcReX9RXR5oYpm8PDtlmWqblQzjwY00-uYLfOX0_iS4MGfEsjadZPfTmJLcOTYC7H4PL9ZRu_XtMDUrGBQQz5b_ad2ZzMXbBNeU6vbxVKDG8VFKWOHAemqHTcvuOAsOCLIqOu-eJpZHlXbx-FXPTYledd-GBDe7IjaC9ll_JK3utCOnCq0qUs6lnXIrQ_Sp1LcTKJJ7aY5f9TxeoAuL-ghDbQ3Xkw6huKyPCz2evOwVLwrB9ZRMlQXgmTnB1OeQvWii1WbmkyV1Zhbz_RPB8ckK7_mFxuPvsXK8wTFiWFmj96sRX470kV-ooSfM5CzKZhSLqgyyaUNC0VaCPq0uuE
      - VAULT_SEAL_UNSEAL_KEY=forest step weird object extend boat ball unit canoe pull render monkey drink monitor behind supply brush frown alone rural minute level host clock
    healthcheck:
      test: ["CMD", "curl", "-f", "http://privacy1-ident:8080/status"]
      interval: 1m
      timeout: 1s
      retries: 2
      start_period: 10s
    hostname: privacy1-ident
    networks:
      - privacy1
    ports:
      - 8084:8080
    restart: always

  privacy1-ident-consumer:
    image: provide/ident
    entrypoint: ./ops/run_consumer.sh
    container_name: privacy1-ident-consumer
    depends_on:
      - privacy1-nats-streaming
      - privacy1-postgres
      - privacy1-redis
    environment:
      - CONSUME_NATS_STREAMING_SUBSCRIPTIONS=true
      - DATABASE_HOST=privacy1-postgres
      - DATABASE_NAME=ident_dev
      - DATABASE_USER=ident
      - DATABASE_PASSWORD=ident
      - DATABASE_SUPERUSER=prvd
      - DATABASE_SUPERUSER_PASSWORD=prvdp455
      - NATS_CLIENT_PREFIX=ident-consumer
      - NATS_URL=nats://privacy1-nats:4222
      - NATS_STREAMING_URL=nats://privacy1-nats-streaming:4222
      - REDIS_HOSTS=privacy1-redis:6379
      - LOG_LEVEL=DEBUG
      - VAULT_API_HOST=privacy1-vault:8080
      - VAULT_API_SCHEME=http
      - VAULT_REFRESH_TOKEN=eyJhbGciOiJSUzI1NiIsImtpZCI6IjEwOjJlOmQ5OmUxOmI4OmEyOjM0OjM3Ojk5OjNhOjI0OmZjOmFhOmQxOmM4OjU5IiwidHlwIjoiSldUIn0.eyJhdWQiOiJodHRwczovL3Byb3ZpZGUuc2VydmljZXMvYXBpL3YxIiwiaWF0IjoxNjA1NzkxMjQ4LCJpc3MiOiJodHRwczovL2lkZW50LnByb3ZpZGUuc2VydmljZXMiLCJqdGkiOiI5YjUxNGIxNS01NTdlLTRhYWQtYTcwOC0wMTcwZTAwZWE1ZmIiLCJuYXRzIjp7InBlcm1pc3Npb25zIjp7InN1YnNjcmliZSI6eyJhbGxvdyI6WyJhcHBsaWNhdGlvbi4zNjAxNTdmOC1kNWExLTQ0NDAtOTE4Yi1mNjhiYjM5YzBkODAiLCJ1c2VyLjIzY2MwN2UwLTM4NTEtNDBkZC1iNjc1LWRmNzY4MDY3MmY3ZCIsIm5ldHdvcmsuKi5jb25uZWN0b3IuKiIsIm5ldHdvcmsuKi5zdGF0dXMiLCJwbGF0Zm9ybS5cdTAwM2UiXX19fSwicHJ2ZCI6eyJhcHBsaWNhdGlvbl9pZCI6IjM2MDE1N2Y4LWQ1YTEtNDQ0MC05MThiLWY2OGJiMzljMGQ4MCIsImV4dGVuZGVkIjp7InBlcm1pc3Npb25zIjp7IioiOjUxMH19LCJwZXJtaXNzaW9ucyI6NTEwLCJ1c2VyX2lkIjoiMjNjYzA3ZTAtMzg1MS00MGRkLWI2NzUtZGY3NjgwNjcyZjdkIn0sInN1YiI6ImFwcGxpY2F0aW9uOjM2MDE1N2Y4LWQ1YTEtNDQ0MC05MThiLWY2OGJiMzljMGQ4MCJ9.SUh84MKBNstdu3KFu1zEAQq03xbPw1D0lLXeogz1HfBJy77bIGf7HLvCuc6bjkh0xj3cEuEus1dC1Dj3BvlZoSXsvz_biTzSapkXzJjpkwOL6qkYDmqTPZvXwqmk-mUNrHTPkqdiIJL7xA46tzHW3E_hjSA9HjEk1kXjPdJQ6_ifkgWNoAaSD--kudIrhZ7vLnfy0H1JEAOsXzSAMoc5_pNG2n79m0ywvb_4l9BqdsHW8N3xSQOFjcp9gD_tqo6ffug3pkpoy-RSguM_OaMR2lj_CHhYxAt0phtjUceDD3K1h5iZ38kSl7izhOdULMmGBhVpBMoSy6_R6ZzpCL3pj8FcReX9RXR5oYpm8PDtlmWqblQzjwY00-uYLfOX0_iS4MGfEsjadZPfTmJLcOTYC7H4PL9ZRu_XtMDUrGBQQz5b_ad2ZzMXbBNeU6vbxVKDG8VFKWOHAemqHTcvuOAsOCLIqOu-eJpZHlXbx-FXPTYledd-GBDe7IjaC9ll_JK3utCOnCq0qUs6lnXIrQ_Sp1LcTKJJ7aY5f9TxeoAuL-ghDbQ3Xkw6huKyPCz2evOwVLwrB9ZRMlQXgmTnB1OeQvWii1WbmkyV1Zhbz_RPB8ckK7_mFxuPvsXK8wTFiWFmj96sRX470kV-ooSfM5CzKZhSLqgyyaUNC0VaCPq0uuE
      - VAULT_SEAL_UNSEAL_KEY=forest step weird object extend boat ball unit canoe pull render monkey drink monitor behind supply brush frown alone rural minute level host clock
    healthcheck:
      test: ["CMD", "curl", "-f", "http://ident:8080/status"]
      interval: 1m
      timeout: 1s
      retries: 2
      start_period: 10s
    hostname: privacy1-ident-consumer
    networks:
      - privacy1
    restart: always

  privacy1-privacy:
    build: ../
    container_name: privacy1-privacy
    depends_on:
      - privacy1-nats-streaming
      - privacy1-postgres
      - privacy1-privacy-consumer
      - privacy1-redis
      - privacy1-vault
    environment:
      - DATABASE_HOST=privacy1-postgres
      - DATABASE_NAME=privacy_dev
      - DATABASE_USER=privacy
      - DATABASE_PASSWORD=privacy
      - DATABASE_SUPERUSER=prvd
      - DATABASE_SUPERUSER_PASSWORD=prvdp455
      - IDENT_API_HOST=privacy1-ident:8080
      - IDENT_API_SCHEME=http
      - LOG_LEVEL=DEBUG
      - NATS_CLIENT_PREFIX=privacy
      - NATS_URL=nats://privacy1-nats:4222
      - NATS_STREAMING_URL=nats://privacy1-nats-streaming:4222
      - PORT=8080
      - VAULT_API_HOST=privacy1-vault:8080
      - VAULT_API_SCHEME=http
      - VAULT_REFRESH_TOKEN=eyJhbGciOiJSUzI1NiIsImtpZCI6IjEwOjJlOmQ5OmUxOmI4OmEyOjM0OjM3Ojk5OjNhOjI0OmZjOmFhOmQxOmM4OjU5IiwidHlwIjoiSldUIn0.eyJhdWQiOiJodHRwczovL3Byb3ZpZGUuc2VydmljZXMvYXBpL3YxIiwiaWF0IjoxNjA1NzkxMjQ4LCJpc3MiOiJodHRwczovL2lkZW50LnByb3ZpZGUuc2VydmljZXMiLCJqdGkiOiI5YjUxNGIxNS01NTdlLTRhYWQtYTcwOC0wMTcwZTAwZWE1ZmIiLCJuYXRzIjp7InBlcm1pc3Npb25zIjp7InN1YnNjcmliZSI6eyJhbGxvdyI6WyJhcHBsaWNhdGlvbi4zNjAxNTdmOC1kNWExLTQ0NDAtOTE4Yi1mNjhiYjM5YzBkODAiLCJ1c2VyLjIzY2MwN2UwLTM4NTEtNDBkZC1iNjc1LWRmNzY4MDY3MmY3ZCIsIm5ldHdvcmsuKi5jb25uZWN0b3IuKiIsIm5ldHdvcmsuKi5zdGF0dXMiLCJwbGF0Zm9ybS5cdTAwM2UiXX19fSwicHJ2ZCI6eyJhcHBsaWNhdGlvbl9pZCI6IjM2MDE1N2Y4LWQ1YTEtNDQ0MC05MThiLWY2OGJiMzljMGQ4MCIsImV4dGVuZGVkIjp7InBlcm1pc3Npb25zIjp7IioiOjUxMH19LCJwZXJtaXNzaW9ucyI6NTEwLCJ1c2VyX2lkIjoiMjNjYzA3ZTAtMzg1MS00MGRkLWI2NzUtZGY3NjgwNjcyZjdkIn0sInN1YiI6ImFwcGxpY2F0aW9uOjM2MDE1N2Y4LWQ1YTEtNDQ0MC05MThiLWY2OGJiMzljMGQ4MCJ9.SUh84MKBNstdu3KFu1zEAQq03xbPw1D0lLXeogz1HfBJy77bIGf7HLvCuc6bjkh0xj3cEuEus1dC1Dj3BvlZoSXsvz_biTzSapkXzJjpkwOL6qkYDmqTPZvXwqmk-mUNrHTPkqdiIJL7xA46tzHW3E_hjSA9HjEk1kXjPdJQ6_ifkgWNoAaSD--kudIrhZ7vLnfy0H1JEAOsXzSAMoc5_pNG2n79m0ywvb_4l9BqdsHW8N3xSQOFjcp9gD_tqo6ffug3pkpoy-RSguM_OaMR2lj_CHhYxAt0phtjUceDD3K1h5iZ38kSl7izhOdULMmGBhVpBMoSy6_R6ZzpCL3pj8FcReX9RXR5oYpm8PDtlmWqblQzjwY00-uYLfOX0_iS4MGfEsjadZPfTmJLcOTYC7H4PL9ZRu_XtMDUrGBQQz5b_ad2ZzMXbBNeU6vbxVKDG8VFKWOHAemqHTcvuOAsOCLIqOu-eJpZHlXbx-FXPTYledd-GBDe7IjaC9ll_JK3utCOnCq0qUs6lnXIrQ_Sp1LcTKJJ7aY5f9TxeoAuL-ghDbQ3Xkw6huKyPCz2evOwVLwrB9ZRMlQXgmTnB1OeQvWii1WbmkyV1Zhbz_RPB8ckK7_mFxuPvsXK8wTFiWFmj96sRX470kV-ooSfM5CzKZhSLqgyyaUNC0VaCPq0uuE
      - VAULT_SEAL_UNSEAL_KEY=forest step weird object extend boat ball unit canoe pull render monkey drink monitor behind supply brush frown alone rural minute level host clock
    healthcheck:
      test: ["CMD", "curl", "-f", "http://privacy1-privacy:8080/status"]
      interval: 1m
      timeout: 1s
      retries: 2
      start_period: 10s
    hostname: privacy1-privacy
    networks:
      - privacy1
    ports:
      - 8083:8080
    restart: always

  privacy1-privacy-consumer:
    build: ../
    entrypoint: ./ops/run_consumer.sh
    container_name: privacy1-privacy-consumer
    depends_on:
      - privacy1-nats-streaming
      - privacy1-postgres
      - privacy1-redis
      - privacy1-vault
    environment:
      - CONSUME_NATS_STREAMING_SUBSCRIPTIONS=true
      - DATABASE_HOST=privacy1-postgres
      - DATABASE_NAME=privacy_dev
      - DATABASE_USER=privacy
      - DATABASE_PASSWORD=privacy
      - DATABASE_SUPERUSER=prvd
      - DATABASE_SUPERUSER_PASSWORD=prvdp455
      - IDENT_API_HOST=privacy1-ident:8080
      - IDENT_API_SCHEME=http
      - LOG_LEVEL=DEBUG
      - NATS_CLIENT_PREFIX=privacy-consumer
      - NATS_URL=nats://privacy1-nats:4222
      - NATS_STREAMING_URL=nats://privacy1-nats-streaming:4222
      - VAULT_API_HOST=privacy1-vault:8080
      - VAULT_API_SCHEME=http
      - VAULT_REFRESH_TOKEN=eyJhbGciOiJSUzI1NiIsImtpZCI6IjEwOjJlOmQ5OmUxOmI4OmEyOjM0OjM3Ojk5OjNhOjI0OmZjOmFhOmQxOmM4OjU5IiwidHlwIjoiSldUIn0.eyJhdWQiOiJodHRwczovL3Byb3ZpZGUuc2VydmljZXMvYXBpL3YxIiwiaWF0IjoxNjA1NzkxMjQ4LCJpc3MiOiJodHRwczovL2lkZW50LnByb3ZpZGUuc2VydmljZXMiLCJqdGkiOiI5YjUxNGIxNS01NTdlLTRhYWQtYTcwOC0wMTcwZTAwZWE1ZmIiLCJuYXRzIjp7InBlcm1pc3Npb25zIjp7InN1YnNjcmliZSI6eyJhbGxvdyI6WyJhcHBsaWNhdGlvbi4zNjAxNTdmOC1kNWExLTQ0NDAtOTE4Yi1mNjhiYjM5YzBkODAiLCJ1c2VyLjIzY2MwN2UwLTM4NTEtNDBkZC1iNjc1LWRmNzY4MDY3MmY3ZCIsIm5ldHdvcmsuKi5jb25uZWN0b3IuKiIsIm5ldHdvcmsuKi5zdGF0dXMiLCJwbGF0Zm9ybS5cdTAwM2UiXX19fSwicHJ2ZCI6eyJhcHBsaWNhdGlvbl9pZCI6IjM2MDE1N2Y4LWQ1YTEtNDQ0MC05MThiLWY2OGJiMzljMGQ4MCIsImV4dGVuZGVkIjp7InBlcm1pc3Npb25zIjp7IioiOjUxMH19LCJwZXJtaXNzaW9ucyI6NTEwLCJ1c2VyX2lkIjoiMjNjYzA3ZTAtMzg1MS00MGRkLWI2NzUtZGY3NjgwNjcyZjdkIn0sInN1YiI6ImFwcGxpY2F0aW9uOjM2MDE1N2Y4LWQ1YTEtNDQ0MC05MThiLWY2OGJiMzljMGQ4MCJ9.SUh84MKBNstdu3KFu1zEAQq03xbPw1D0lLXeogz1HfBJy77bIGf7HLvCuc6bjkh0xj3cEuEus1dC1Dj3BvlZoSXsvz_biTzSapkXzJjpkwOL6qkYDmqTPZvXwqmk-mUNrHTPkqdiIJL7xA46tzHW3E_hjSA9HjEk1kXjPdJQ6_ifkgWNoAaSD--kudIrhZ7vLnfy0H1JEAOsXzSAMoc5_pNG2n79m0ywvb_4l9BqdsHW8N3xSQOFjcp9gD_tqo6ffug3pkpoy-RSguM_OaMR2lj_CHhYxAt0phtjUceDD3K1h5iZ38kSl7izhOdULMmGBhVpBMoSy6_R6ZzpCL3pj8FcReX9RXR5oYpm8PDtlmWqblQzjwY00-uYLfOX0_iS4MGfEsjadZPfTmJLcOTYC7H4PL9ZRu_XtMDUrGBQQz5b_ad2ZzMXbBNeU6vbxVKDG8VFKWOHAemqHTcvuOAsOCLIqOu-eJpZHlXbx-FXPTYledd-GBDe7IjaC9ll_JK3utCOnCq0qUs6lnXIrQ_Sp1LcTKJJ7aY5f9TxeoAuL-ghDbQ3Xkw6huKyPCz2evOwVLwrB9ZRMlQXgmTnB1OeQvWii1WbmkyV1Zhbz_RPB8ckK7_mFxuPvsXK8wTFiWFmj96sRX470kV-ooSfM5CzKZhSLqgyyaUNC0VaCPq0uuE
      - VAULT_SEAL_UNSEAL_KEY=forest step weird object extend boat ball unit canoe pull render monkey drink monitor behind supply brush frown alone rural minute level host clock
    healthcheck:
      test: ["CMD", "curl", "-f", "http://privacy1-privacy:8080/status"]
      interval: 1m
      timeout: 1s
      retries: 2
      start_period: 10s
    hostname: privacy1-privacy-consumer
    networks:
      - privacy1
    restart: always

  privacy1-vault:
    image: provide/vault:privacy-dev
    container_name: privacy1-vault
    depends_on:
      - privacy1-ident
      - privacy1-postgres
    environment:
      - DATABASE_HOST=privacy1-postgres
      - DATABASE_NAME=vault_dev
      - DATABASE_USER=vault
      - DATABASE_PASSWORD=vault
      - DATABASE_SUPERUSER=prvd
      - DATABASE_SUPERUSER_PASSWORD=prvdp455
      - IDENT_API_HOST=privacy1-ident:8080
      - IDENT_API_SCHEME=http
      - LOG_LEVEL=DEBUG
      - PORT=8080
      - SEAL_UNSEAL_VALIDATION_HASH=0x1c1381fd075f1ee3d42799bb8da0602a2afb9ef4b492bf1eae72399ecc81b0f0
    healthcheck:
      test: ["CMD", "curl", "-f", "http://privacy1-vault:8080/status"]
      interval: 1m
      timeout: 1s
      retries: 2
      start_period: 10s
    hostname: privacy1-vault
    networks:
      - privacy1
    ports:
      - 8085:8080
    restart: always

networks:
  privacy0:
    driver: bridge
    ipam:
      config:
        - subnet: 172.50.0.0/24
  privacy1:
    driver: bridge
    ipam:
      config:
        - subnet: 172.60.0.0/24

volumes:
  privacy0-db:
  privacy1-db:
